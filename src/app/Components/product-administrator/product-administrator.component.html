<div class="container" id="main-container" style="background-color:grey;">
  <h3>Department Manager Products Home </h3>
  <button type="button" (click)="ViewProducts()" class="btn btn-primary">SHOW PRODUCTS </button>
  <button type="button" (click)="AddProdShowDiv()" class="btn btn-primary">ADD NEW PRODUCT</button>



  <!-- AFFICHAGE DES PRODUITS AVEC OPTION DELETE-->

  <div *ngIf="show" class="card-deck">
    <table class="table caption-top">

      <tr>
        <th scope="col">#</th>
        <th scope="col">Title </th>
        <th scope="col">Description</th>
        <th scope="col">Quantity</th>
        <th scope="col">Weight</th>
        <th scope="col">Max Quantity</th>
        <th scope="col">Price</th>
        <th scope="col">Buying Price</th>
        <th>Profit Margin</th>
        <th scope="col">Image</th>
      </tr>

      <tr *ngFor="let p of ListProducts" class="col-12 col-sm-6 col-md-4 p-2">
        <td>{{p.idProduct}}</td>
        <td>{{p.titleProduct}}</td>
        <td>{{p.descriptionProduct}}</td>
        <td>{{p.quantityProduct}}</td>
        <td>{{p.weightProduct}}</td>
        <td>{{p.maxQuantityProduct}}</td>
        <td>{{p.priceProduct}} DT</td>
        <td>{{p.buyingPriceProduct}} DT </td>
        <td>{{p.buyingPriceProduct-p.priceProduct}}</td>
        <div>
          <img src="{{'http://localhost:9091/SpringMVC/servlet/Imgarticles/'+p.idProduct}}" width="100" height="150"
            class="card-img-top" alt="...">
        </div>
        <button type="button" class="btn-primary" (click)="updateProductInterface(p.idProduct,p)"> Update </button>
        <button (click)="deleteProduct(p.idProduct)" type="button" class="btn-danger"> DELETE </button>
      </tr>
    </table>
  </div>

  <!-- FORMULAIRE D'AJOUT D'UN NOUVEAU PRODUITS -->



  <div *ngIf="showIntAddProd" class="container" style="padding-top: 100;">
    <h1>BarcodeReader</h1>

    <form (ngSubmit)="ReadBarcode()" [formGroup]="form">
      <input ng-model="file_upload" name="file" type="file" (change)="fileChange($event)" #fileInput>
      <button type="submit">Submit</button>
    </form>

    <div *ngIf="tunisianBarCode; else elseBlock">


      <form #F="ngForm">
        <h1>ADD NEW PRODUCTS INTERFACE</h1>
        <fieldset>
          <div class="form-group">
            <label>Title Of Product : </label>
            <input type="text" required placeholder="Title Of Product" #t="ngModel" id="titleProduct"
              name="titleProduct" [(ngModel)]="product.titleProduct">
            <!-- <div class="alert alert-danger" *ngIf="t.invalid && t.touched" >
              <div *ngIf="t.errors.required">Title Is Obilgatory</div>
              <div *ngIf="t.errors.minlength">Invalid Title</div>
            </div> -->

          </div>

          <div class="form-group">
            <label>Product Desccription : </label>
            <input type="text" required placeholder="descriptionProduct" #d="ngModel" id="descriptionProduct"
              name="descriptionProduct" [(ngModel)]="product.descriptionProduct">
            <!-- <div class="alert alert-danger" *ngIf="d.invalid && d.touched" >
              <div *ngIf="d.errors.required">Description Is Obilgatory</div>
              <div *ngIf="d.errors.minlength">Invalid Description</div>
            </div> -->
          </div>


          <div class="form-group">
            <label>Product Quantity : </label>
            <input type="number" required placeholder="quantityProduct" #q="ngModel" pattern="[1-9][0-9]"
              name="quantityProduct" [(ngModel)]="product.quantityProduct">
            <!-- <div class="alert alert-danger" *ngIf="q.invalid && q.touched" >
              <div *ngIf="q.errors.required">Quantity Is Obilgatory</div>
              <div *ngIf="q.errors.minlength">Invalid Quantity</div>
            </div> -->
          </div>



          <div class="form-group">
            <label>Product Initial Price : </label>
            <input type="number" required placeholder="priceProduct" #pp="ngModel" pattern="[1-9][0-9]"
              name="priceProduct" [(ngModel)]="product.priceProduct">
            <!-- <div class="alert alert-danger" *ngIf="pp.invalid && pp.touched" >
              <div *ngIf="pp.errors.required">Price Is Obilgatory</div>
              <div *ngIf="pp.errors.pattern">Invalid Price</div>
            </div> -->
          </div>




          <div class="form-group">
            <label>Product Weight : </label>
            <input type="number" required placeholder="weightProduct" #wp="ngModel" name="weightProduct"
              pattern="[1-9][0-9][0-9]" [(ngModel)]="product.weightProduct">
            <!-- <div class="alert alert-danger" *ngIf="wp.invalid && wp.touched" >
              <div *ngIf="wp.errors.required">Weight Is Obilgatory</div>
              <div *ngIf="wp.errors.pattern">Invalid Weight</div>
            </div> -->

          </div>


          <div class="form-group"></div>
          <label>Buying Price : </label>
          <input type="number" required placeholder="buyingPriceProduct" #bp="ngModel" pattern="[1-9][0-9]"
            name="buyingPriceProduct" [(ngModel)]="product.buyingPriceProduct">
          <!-- <div class="alert alert-danger" *ngIf="bp.invalid && bp.touched" >
            <div *ngIf="bp.errors.required">Buying Price Is Obilgatory</div>
            <div *ngIf="bp.errors.pattern">Invalid Buying Price</div>
          </div> -->




          <div class="form-group"></div>
          <label>Product Stock Quantity : </label>
          <input type="number" required placeholder="maxQuantityProduct" #mqp="ngModel" name="maxQuantityProduct"
            [(ngModel)]="product.maxQuantityProduct">
          <!-- <div class="alert alert-danger" *ngIf="mqp.invalid && mqp.touched" >
            <div *ngIf="mqp.errors.required">Max Quantity Product Is Obilgatory</div>
            <div *ngIf="mqp.errors.pattern">Invalid Max Quantity Product</div>
          </div> -->
          <br>



          <div class="form-group">
            <label>Product Under Category : </label>
            <select id="underCategory" name="underCategory" (change)="onChange($event.target.value)"
              [(ngModel)]="product.UnderCategory" class="form-control">
              <option *ngFor="let u of ListUnderCategory" [value]="u.idUnderCategory">
                {{u.nameUnderCategory}}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Product Department : </label>
            <select id="departmentProduct" name="departmentProduct" (change2)="onChange($event.target.value)"
              [(ngModel)]="product.Department" class="form-control">
              <option *ngFor="let d of ListDepartments" [value]="d.idDepartment">
                {{d.nameDepartment}}
              </option>
            </select>
          </div>




          <label>Product Image</label>
          <input type="file" name="file" [(ngModel)]="product.fileName"><br>


          <button type="button" type="submit" id="addProductToDatabase" (click)="addProduct()"
            class="btn btn-success">ADD
            TO DATABASE</button>

        </fieldset>
      </form>
    </div>
    <br>


  </div>
</div>

<!-- Updated view product-->

<div *ngIf="updateProductInt" class="container" style="padding-top: 100;">
  <h1>UPDATE Product</h1>

  <form #H="ngForm">
    <fieldset>
      <div class="form-group">
        <label>Title Of Product : </label>
        <input type="text" required placeholder="Title Of Product" #t="ngModel" id="titleProduct" name="titleProduct"
          [(ngModel)]="productToUpdate.titleProduct">
        <!-- <div class="alert alert-danger" *ngIf="t.invalid && t.touched" >
        <div *ngIf="t.errors.required">Title Is Obilgatory</div>
    </div> -->

      </div>

      <div class="form-group">
        <label>Product Desccription : </label>
        <input type="text" required placeholder="descriptionProduct" #d="ngModel" id="descriptionProduct"
          name="descriptionProduct" [(ngModel)]="productToUpdate.descriptionProduct">
        <!-- <div class="alert alert-danger" *ngIf="d.invalid && d.touched" >
        <div *ngIf="d.errors.required">Description Is Obilgatory</div>
        <div *ngIf="d.errors.minlength">Invalid Description</div>
    </div> -->
      </div>


      <div class="form-group">
        <label>Product Quantity : </label>
        <input type="number" required placeholder="quantityProduct" #q="ngModel" pattern="[1-9][0-9]"
          name="quantityProduct" [(ngModel)]="productToUpdate.quantityProduct">
        <!-- <div class="alert alert-danger" *ngIf="q.invalid && q.touched" >
        <div *ngIf="q.errors.required">Quantity Is Obilgatory</div>
        <div *ngIf="q.errors.minlength">Invalid Quantity</div>
    </div> -->
      </div>



      <div class="form-group">
        <label>Product Initial Price : </label>
        <input type="number" required placeholder="priceProduct" #pp="ngModel" pattern="[1-9][0-9]" name="priceProduct"
          [(ngModel)]="productToUpdate.priceProduct">
        <!-- <div class="alert alert-danger" *ngIf="pp.invalid && pp.touched" >
        <div *ngIf="pp.errors.required">Price Is Obilgatory</div>
        <div *ngIf="pp.errors.pattern">Invalid Price</div>
    </div> -->
      </div>




      <div class="form-group">
        <label>Product Weight : </label>
        <input type="number" required placeholder="weightProduct" #wp="ngModel" name="weightProduct"
          pattern="[1-9][0-9][0-9]" [(ngModel)]="productToUpdate.weightProduct">
        <!-- <div class="alert alert-danger" *ngIf="wp.invalid && wp.touched" >
        <div *ngIf="wp.errors.required">Weight Is Obilgatory</div>
        <div *ngIf="wp.errors.pattern">Invalid Weight</div>
    </div> -->

      </div>


      <div class="form-group"></div>
      <label>Buying Price : </label>
      <input type="number" required placeholder="buyingPriceProduct" #bp="ngModel" pattern="[1-9][0-9]"
        name="buyingPriceProduct" [(ngModel)]="productToUpdate.buyingPriceProduct">
      <!-- <div class="alert alert-danger" *ngIf="bp.invalid && bp.touched" >
        <div *ngIf="bp.errors.required">Buying Price Is Obilgatory</div>
        <div *ngIf="bp.errors.pattern">Invalid Buying Price</div>
      </div> -->




      <div class="form-group"></div>
      <label>Product Stock Quantity : </label>
      <input type="number" required placeholder="maxQuantityProduct" #mqp="ngModel" name="maxQuantityProduct"
        [(ngModel)]="productToUpdate.maxQuantityProduct">
      <!-- <div class="alert alert-danger" *ngIf="mqp.invalid && mqp.touched" >
        <div *ngIf="mqp.errors.required">Max Quantity Product Is Obilgatory</div>
        <div *ngIf="mqp.errors.pattern">Invalid Max Quantity Product</div>
      </div> -->
      <br>


      <button type="button" id="appdateProduct" (click)="updateProduct(productToUpdate.idProduct, productToUpdate)"
        class="btn btn-success">Update
        Product</button>
    </fieldset>
  </form>
  <br>


</div>